<!doctype HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Qawa</title>


    <link rel="stylesheet" type="text/css" href="css/base.css">
    <script type="text/javascript" src="js/ender.min.js"></script>
    <script type="text/javascript" src="js/chat.js"></script>
    <script type="text/javascript">






        $.domReady(function() {
            /*
                1. resize body window height to accommodate device window height.
                2. Connect to channel.
            */


            Chat.prototype.draw_messages = function(msgs) {
                var l = msgs.length,
                    msgs_html = '';



                // should trim some of the old messages off.


                for (var i = 0; i < l; i++) {
                    var msg = msgs[i];
                     msgs_html += '<li><span>' + msg.author + '</span>' + msg.message + '</li>';
                }
                $('#message_list').append(msgs_html)

                $('#body')[0].scrollTop += 100; // this should be smarter, if scroll position is not at the bottom then it shouldn't automatically scroll.
            }

            chat = new Chat();


            var channel = window.location.hash || false;
            if (channel) {
                $('#status').html('Connecting to ' + channel + '...');

                chat.past_messages('/messages.json', function() {
                    $('#status').hide();
                    $('#message_list').css('display', 'block');

                    //chat.live_messages('/live.json');;
                });

            } else {
                $('#status').html('Please select a channel.')
            }


            $('form').bind('submit', function(e) {



                chat.post_message(
                    'post.json',
                    {message: $('#message').val()},
                    function() {
                        console.log('does it come here?')

                        $('#message').val(' ');
                    }
                );

                e.preventDefault();
            });


        });

    </script>
</head>
<body>

    <div id="container">
        <div id="header">
            Qawa
        </div>

        <div id="body">
            <ul id="message_list">
            </ul>

            <div id="status">Loading...</div>
        </div>


        <div id="footer">
            <form method="post" action="">
                <input type="text" name="message" id="message">
                <input type="submit" value="Send" id="submit">
            </form>
        </div>
    </div>


</body>
</html>
